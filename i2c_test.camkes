/*
 * Copyright (C) 2022, HENSOLDT Cyber GmbH
 * SPDX-License-Identifier: BSD-3-Clause
 */

 /*
  * I2C_Test CAmkES Component
  */

#pragma once
import <std_connector.camkes>;

#include "system_config.h"

#include "components/i2c/i2c.camkes"

I2C_MEMORY_COMPONENT_DEFINE(I2CDriver)


I2C_HARDWARE_COMPONENTS(I2CDriverHw)

  component I2CTest {
    control;

    consumes I2CUnlock i2cBus_notify;

    uses        if_I2C              i2c_rpc;
    dataport    Buf                 i2c_port;

  }
  assembly {
      composition {
        //-------------------------------
        // I2C
        //-------------------------------

        component I2CTest i2ctest;

        component I2CDriver  i2cdriver;
        component I2CDriverHw i2cdriverhw;

        I2C_INSTANCE_CONNECT_CLIENT(
            i2cdriver,
            i2ctest.i2c_rpc, i2ctest.i2c_port,
            i2ctest.i2cBus_notify, 1
        )
        I2C_HARDWARE_INSTANCE_CONNECT(
            i2cdriver,
            i2cdriverhw
        )
    }
      configuration {
        I2C_HARDWARE_INSTANCE_CONFIGURE_SELF(
            i2cdriverhw,
            I2C0_ADDR)
    }

  }