/*
 * Copyright (C) 2022, HENSOLDT Cyber GmbH
 * SPDX-License-Identifier: BSD-3-Clause
 */

 /*
  * I2C_Test CAmkES Component
  */

#pragma once
import <std_connector.camkes>;

#include "system_config.h"

  component I2CTest {
    control;
    dataport Buf(0x1000)    regBase;
    dataport Buf(0x1000)    gpioBase;
  }
  component I2C_HW {
      hardware;
      dataport Buf(0x1000)    regBase;
      dataport Buf(0x1000)    gpioBase;
  }
  assembly {
      composition {
          //-------------------------------
          // I2C
          //-------------------------------

          component I2CTest i2ctest;
          component I2C_HW  i2c_hw;
        //  component GPIO_HW gpio_hw;

          connection seL4HardwareMMIO 
              i2ctest_mmio (
                  from i2ctest.regBase,
                  to i2c_hw.regBase,
              );
           connection seL4HardwareMMIO
              i2ctest_gpio_mmio (
                   from i2ctest.gpioBase,
                   to i2c_hw.gpioBase
              );
          /*connection seL4HardwareMMIO
              i2ctest_gpio_mmio (
                  from i2ctest.gpioBase,
                  to gpio_hw.gpioBase
              );*/
      }

      configuration {
          i2c_hw.regBase_paddr = 0x3F205000;
          i2c_hw.regBase_size = 0x1000;
          i2c_hw.gpioBase_paddr = 0x3F200000;
          i2c_hw.gpioBase_size = 0x1000;
        /*  gpio_hw.gpioBase_paddr = 0x3F200000;
          gpio_hw.gpioBase_size = 0x1000;*/
      }
  }